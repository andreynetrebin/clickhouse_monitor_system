<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤{% endblock %}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        .header h1 {
            margin: 0;
            font-size: 2rem;
        }
        .nav {
            background: #2c3e50;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .nav a:hover {
            background-color: #34495e;
        }
        .nav a.active {
            background-color: #3498db;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .query-item {
            border-left: 4px solid #3498db;
            padding: 1rem;
            margin-bottom: 1rem;
            background: white;
            border-radius: 4px;
        }
        .query-item.critical {
            border-left-color: #e74c3c;
        }
        .query-item.optimized {
            border-left-color: #27ae60;
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .status-new { background: #3498db; color: white; }
        .status-analysis { background: #f39c12; color: white; }
        .status-optimized { background: #27ae60; color: white; }
        .status-ignored { background: #95a5a6; color: white; }
        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #229954; }
        .btn-warning { background: #f39c12; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .sql-code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .filter-bar {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .filter-select {
            padding: 0.5rem;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background: white;
        }
       /* –¢—É–ª—Ç–∏–ø—ã */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
  /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è SQL –±–ª–æ–∫–æ–≤ */
        .sql-block {
            position: relative;
        }

        .sql-block .btn {
            transition: all 0.3s ease;
        }

        .sql-block .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üöÄ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ ClickHouse</h1>
        </div>
    </div>

    <div class="nav">
    <div class="container">
        <a href="{% url 'query_lab:lab_dashboard' %}" {% if request.resolver_match.url_name == 'lab_dashboard' %}class="active"{% endif %}>
            üìä –î–∞—à–±–æ—Ä–¥
        </a>
        <a href="{% url 'query_lab:query_list' %}" {% if request.resolver_match.url_name == 'query_list' %}class="active"{% endif %}>
            üìã –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã
        </a>
        <a href="{% url 'query_lab:analytics_dashboard' %}" {% if request.resolver_match.url_name == 'analytics_dashboard' %}class="active"{% endif %}>
            üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
        </a>
        <div style="display: inline-block; position: relative;">
            <a href="#" style="background: #34495e;">
                üìã –û—Ç—á–µ—Ç—ã ‚ñº
            </a>
            <div style="position: absolute; top: 100%; left: 0; background: #2c3e50; min-width: 200px; border-radius: 0 0 4px 4px; display: none; z-index: 1000;">
                <a href="{% url 'query_lab:optimization_report' %}" style="display: block; padding: 0.75rem 1rem; border-bottom: 1px solid #34495e;">
                    üöÄ –ü–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º
                </a>
                <a href="{% url 'query_lab:performance_report' %}" style="display: block; padding: 0.75rem 1rem;">
                    üìà –ü–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                </a>
            </div>
        </div>
        <a href="{% url 'query_lab:api_test_page' %}" {% if request.resolver_match.url_name == 'api_test_page' %}class="active"{% endif %}>
            üß™ API —Ç–µ—Å—Ç
        </a>
        <a href="{% url 'admin:index' %}" target="_blank">
            ‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞
        </a>
        <a href="{% url 'monitor_dashboard' %}">
            üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        </a>
    </div>
</div>

<script>
    // –†–∞—Å–∫—Ä—ã–≤–∞—é—â–µ–µ—Å—è –º–µ–Ω—é –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const reportsDropdown = document.querySelector('.nav div[style*="position: relative"]');
        const dropdownMenu = reportsDropdown.querySelector('div[style*="position: absolute"]');

        reportsDropdown.addEventListener('mouseenter', function() {
            dropdownMenu.style.display = 'block';
        });

        reportsDropdown.addEventListener('mouseleave', function() {
            dropdownMenu.style.display = 'none';
        });
    });
</script>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>
    <script>
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π textarea –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();

            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);

                if (successful) {
                    showNotification('‚úÖ –ó–∞–ø—Ä–æ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                } else {
                    showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'error');
                }
            } catch (err) {
                document.body.removeChild(textarea);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err, 'error');
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∏–∑ –±–ª–æ–∫–∞
        function copySQL(button) {
            const sqlBlock = button.closest('.sql-block');
            const sqlCode = sqlBlock.querySelector('.sql-code');
            const text = sqlCode.textContent || sqlCode.innerText;
            copyToClipboard(text);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = 'notification fade-in';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                font-size: 0.9rem;
            `;

            if (type === 'success') {
                notification.style.background = '#27ae60';
            } else if (type === 'error') {
                notification.style.background = '#e74c3c';
            } else {
                notification.style.background = '#3498db';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
        function highlightSQL(element) {
            const sql = element.textContent;
            // –ü—Ä–æ—Å—Ç–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ SQL
            const keywords = [
                'SELECT', 'FROM', 'WHERE', 'JOIN', 'LEFT', 'RIGHT', 'INNER', 'OUTER',
                'GROUP BY', 'ORDER BY', 'HAVING', 'LIMIT', 'INSERT', 'UPDATE', 'DELETE',
                'CREATE', 'ALTER', 'DROP', 'TABLE', 'INDEX', 'VIEW', 'AS', 'ON', 'AND', 'OR',
                'NOT', 'IN', 'BETWEEN', 'LIKE', 'IS', 'NULL', 'TRUE', 'FALSE'
            ];

            let highlighted = sql;
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                highlighted = highlighted.replace(regex, `<span style="color: #3498db; font-weight: bold;">${keyword}</span>`);
            });

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
            highlighted = highlighted.replace(/'[^']*'/g, '<span style="color: #e74c3c;">$&</span>');

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —á–∏—Å–µ–ª
            highlighted = highlighted.replace(/\b\d+\b/g, '<span style="color: #27ae60;">$&</span>');

            element.innerHTML = highlighted;
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∫–æ –≤—Å–µ–º SQL –±–ª–æ–∫–∞–º
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sql-code').forEach(block => {
                highlightSQL(block);
            });
        });

        // –ê–≤—Ç–æ-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ textarea –ø—Ä–∏ –≤–≤–æ–¥–µ
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'TEXTAREA') {
                e.target.style.height = 'auto';
                e.target.style.height = (e.target.scrollHeight) + 'px';
            }
        });
    </script>
</body>
</html>