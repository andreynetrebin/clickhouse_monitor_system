{% extends 'query_lab/base.html' %}
{% load humanize %}

{% block title %}–û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤{% endblock %}

{% block content %}
<div class="card">
    <h1>üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
    <p style="color: #7f8c8d; margin-bottom: 2rem;">
        –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞: {{ start_date|date:"d.m.Y" }} - {{ end_date|date:"d.m.Y" }}
    </p>
</div>

<!-- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã -->
<div class="card">
    <h3>üìÖ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ecf0f1;">–ú–µ—Å—è—Ü</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–£–ª—É—á—à–µ–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for month in monthly_trends %}
                <tr style="border-bottom: 1px solid #ecf0f1;">
                    <td style="padding: 0.75rem;">
                        <strong>{{ month.month }}</strong>
                    </td>
                    <td style="padding: 0.75rem; text-align: right;">{{ month.total }}</td>
                    <td style="padding: 0.75rem; text-align: right;">{{ month.optimized }}</td>
                    <td style="padding: 0.75rem; text-align: right;">
                        {{ month.optimization_rate|floatformat:1 }}%
                    </td>
                    <td style="padding: 0.75rem; text-align: right;">
                        {% if month.improvement %}
                        +{{ month.improvement|floatformat:1 }}%
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 2rem; text-align: center; color: #7f8c8d;">
                        üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card">
    <h3>üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞</h3>
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ecf0f1;">–ù–µ–¥–µ–ª—è</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–í—Å–µ–≥–æ</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–£–ª—É—á—à–µ–Ω–∏–µ</th>
                    <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ecf0f1;">–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ (–¥–Ω–∏)</th>
                </tr>
            </thead>
            <tbody>
                {% for week in weekly_stats %}
                <tr style="border-bottom: 1px solid #ecf0f1;">
                    <td style="padding: 0.75rem;">
                        {{ week.week|date:"d.m.Y" }}
                    </td>
                    <td style="padding: 0.75rem; text-align: right;">{{ week.total }}</td>
                    <td style="padding: 0.75rem; text-align: right;">{{ week.optimized }}</td>
                    <td style="padding: 0.75rem; text-align: right;">
                        {% if week.avg_improvement %}
                        +{{ week.avg_improvement|floatformat:1 }}%
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td style="padding: 0.75rem; text-align: right;">
                        {% if week.avg_analysis_days %}
                        {{ week.avg_analysis_days|floatformat:1 }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 2rem; text-align: center; color: #7f8c8d;">
                        üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}